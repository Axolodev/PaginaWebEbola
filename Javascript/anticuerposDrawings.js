var arrAnticuerpos = [
	{
		"mAb": "1H3",
		"inicio": 267,
		"fin": 281,
		"GPRegion": "Z:G1",
		"Conservation": "100%",
		"EpType": "Conformational",
		"EpSeq": "SNTTGKLIWKVNPEI",
		"Level": 1
	},
	{
		"mAb": "2G4",
		"inicio": 501,
		"fin": 515,
		"GPRegion": "Z:G2",
		"Conservation": "93.30%",
		"EpType": "Conformational",
		"EpSeq": "REAIVNAQPKCNPNL",
		"Level": 4
	},
	{
		"mAb": "4G7",
		"inicio": 501,
		"fin": 515,
		"GPRegion": "Z:G2",
		"Conservation": "93.30%",
		"EpType": "Linear",
		"EpSeq": "REAIVNAQPKCNPNL",
		"Level": 5
	},
	{
		"mAb": "5D2",
		"inicio": 329,
		"fin": 343,
		"GPRegion": "Z:G1",
		"Conservation": "73.30%",
		"EpType": "Linear",
		"EpSeq": "DPGTNTTTEDHKIMA",
		"Level": 7
	},
	{
		"mAb": "5E6.",
		"inicio": 401,
		"fin": 415,
		"GPRegion": "Z:G1",
		"Conservation": "80%",
		"EpType": "Linear",
		"EpSeq": "ATQVEQHHRRTDNDS",
		"Level": 1
	},
	{
		"mAb": "7C9",
		"inicio": 157,
		"fin": 369,
		"GPRegion": "Z,GP1",
		"Conservation": "91.50%",
		"EpType": "Conformational",
		"EpSeq": "GAFFLYDRLASTVIYRGTTFAEGVVAFLILPQAKKDFFSSHPLREPVNATEDPSSGYYSTTIRYQATGFGTNETEYLFEVDNLTYVQLESRFTPQFLLQLNETIYTSGKRSNTTGKLIWKVNPEIDTTIGEWAFWETKKNLTRKIRSEELSFTAVSNRAKNISGQSPARTSSDPGTNTTTEDHKIMASENSSAMVQVHSQGREAAVSHLTTLA",
		"Level": 4
	},
	{
		"mAb": "7G4",
		"inicio": 157,
		"fin": 369,
		"GPRegion": "Z,GP1",
		"Conservation": "91.50%",
		"EpType": "Conformational",
		"EpSeq": "GAFFLYDRLASTVIYRGTTFAEGVVAFLILPQAKKDFFSSHPLREPVNATEDPSSGYYSTTIRYQATGFGTNETEYLFEVDNLTYVQLESRFTPQFLLQLNETIYTSGKRSNTTGKLIWKVNPEIDTTIGEWAFWETKKNLTRKIRSEELSFTAVSNRAKNISGQSPARTSSDPGTNTTTEDHKIMASENSSAMVQVHSQGREAAVSHLTTLA",
		"Level": 5
	},
	{
		"mAb": "10C8",
		"inicio": 157,
		"fin": 369,
		"GPRegion": "Z,GP1",
		"Conservation": "91.50%",
		"EpType": "Conformational",
		"EpSeq": "GAFFLYDRLASTVIYRGTTFAEGVVAFLILPQAKKDFFSSHPLREPVNATEDPSSGYYSTTIRYQATGFGTNETEYLFEVDNLTYVQLESRFTPQFLLQLNETIYTSGKRSNTTGKLIWKVNPEIDTTIGEWAFWETKKNLTRKIRSEELSFTAVSNRAKNISGQSPARTSSDPGTNTTTEDHKIMASENSSAMVQVHSQGREAAVSHLTTLA",
		"Level": 6
	},
	{
		"mAb": "KZ52",
		"inicio": 42,
		"fin": 43,
		"GPRegion": "Z:GP1 GP2",
		"Conservation": "100%",
		"EpType": "Conformational",
		"EpSeq": "LVVNAQPKCNPHNQDGLIC",
		"Level": 1
	},
	{
		"mAb": "KZ52",
		"inicio": 505,
		"fin": 513,
		"GPRegion": "Z:GP1 GP2",
		"Conservation": "100%",
		"EpType": "Conformational",
		"EpSeq": "LVVNAQPKCNPHNQDGLIC",
		"Level": 1
	},
	{
		"mAb": "KZ52",
		"inicio": 549,
		"fin": 556,
		"GPRegion": "Z:GP1 GP2",
		"Conservation": "100%",
		"EpType": "Conformational",
		"EpSeq": "LVVNAQPKCNPHNQDGLIC",
		"Level": 1
	}, /*10*/
	{
		"mAb": "13F6",
		"inicio": 401,
		"fin": 417,
		"GPRegion": "Z,GP1",
		"Conservation": "76.40%",
		"EpType": "Linear",
		"EpSeq": "ATQVEQHHRRTDNDSTA",
		"Level": 5
	},
	{
		"mAb": "6D8",
		"inicio": 389,
		"fin": 405,
		"GPRegion": "Z,GP1",
		"Conservation": "82.40%",
		"EpType": "Linear",
		"EpSeq": "HNTPVYKLDISEATQVE",
		"Level": 4
	},
	{
		"mAb": "12B5",
		"inicio": 477,
		"fin": 493,
		"GPRegion": "Z,GP1",
		"Conservation": "94.10%",
		"EpType": "Linear",
		"EpSeq": "GKLGLITNTIAGVAGLI",
		"Level": 7
	},
	{
		"mAb": "6E3.",
		"inicio": 401,
		"fin": 417,
		"GPRegion": "Z:GP1",
		"Conservation": "76.40%",
		"EpType": "Linear",
		"EpSeq": "ATQVEQHHRRTDNDSTA",
		"Level": 7
	},

	{
		"mAb": "13C6",
		"inicio": 392,
		"fin": 479,
		"GPRegion": "Z,S,IC:GP1,GP2, sGP",
		"Conservation": "93.60%",
		"EpType": "Conformational",
		"EpSeq": "RSEELSFTAVSNRAKNISGQSPARTSSDPGTNTTTEDHKIMASENSSAMVQVHSQGREAAVSHLTTLATISTSPQPPTTKPGPDNSTHNTPVYKLDISEATQVEQHHRRTDNDSTASDTPPATTAAGPPKAENTNTSKGTDLLDPATTTSPQNHSETAGNNNTHHQDTGEESASSGKLTGGRRARREAIVNAQPKCNPNLHYWTTQDEGAAIGLAWIPYFGPAAEGIYTEGLMHNQDGLICGLRQLANETTQALQLFLRATTELRTFSILNRKAIDFLLQRWGGTCHILGPDCCIEPHDWTKNITDKIDQIIHDFVDKTL",
		"Level": 6
	}, /* 15 */
	{
		"mAb": "13C6",
		"inicio": 494,
		"fin": 635,
		"GPRegion": "Z,S,IC:GP1,GP2, sGP",
		"Conservation": "93.60%",
		"EpType": "Conformational",
		"EpSeq": "RSEELSFTAVSNRAKNISGQSPARTSSDPGTNTTTEDHKIMASENSSAMVQVHSQGREAAVSHLTTLATISTSPQPPTTKPGPDNSTHNTPVYKLDISEATQVEQHHRRTDNDSTASDTPPATTAAGPPKAENTNTSKGTDLLDPATTTSPQNHSETAGNNNTHHQDTGEESASSGKLTGGRRARREAIVNAQPKCNPNLHYWTTQDEGAAIGLAWIPYFGPAAEGIYTEGLMHNQDGLICGLRQLANETTQALQLFLRATTELRTFSILNRKAIDFLLQRWGGTCHILGPDCCIEPHDWTKNITDKIDQIIHDFVDKTL",
		"Level": 6
	},
	{
		"mAb": "6D3",
		"inicio": 302,
		"fin": 479,
		"GPRegion": "Z,S,IC:GP1,GP2 sGP",
		"Conservation": "93.60%",
		"EpType": "Conformational",
		"EpSeq": "RSEELSFTAVSNRAKNISGQSPARTSSDPGTNTTTEDHKIMASENSSAMVQVHSQGREAAVSHLTTLATISTSPQPPTTKPGPDNSTHNTPVYKLDISEATQVEQHHRRTDNDSTASDTPPATTAAGPPKAENTNTSKGTDLLDPATTTSPQNHSETAGNNNTHHQDTGEESASSGKLTGGRRARREAIVNAQPKCNPNLHYWTTQDEGAAIGLAWIPYFGPAAEGIYTEGLMHNQDGLICGLRQLANETTQALQLFLRATTELRTFSILNRKAIDFLLQRWGGTCHILGPDCCIEPHDWTKNITDKIDQIIHDFVDKTL",
		"Level": 3
	},
	{
		"mAb": "6D3",
		"inicio": 494,
		"fin": 635,
		"GPRegion": "Z,S,IC:GP1,GP2 sGP",
		"Conservation": "93.60%",
		"EpType": "Conformational",
		"EpSeq": "RSEELSFTAVSNRAKNISGQSPARTSSDPGTNTTTEDHKIMASENSSAMVQVHSQGREAAVSHLTTLATISTSPQPPTTKPGPDNSTHNTPVYKLDISEATQVEQHHRRTDNDSTASDTPPATTAAGPPKAENTNTSKGTDLLDPATTTSPQNHSETAGNNNTHHQDTGEESASSGKLTGGRRARREAIVNAQPKCNPNLHYWTTQDEGAAIGLAWIPYFGPAAEGIYTEGLMHNQDGLICGLRQLANETTQALQLFLRATTELRTFSILNRKAIDFLLQRWGGTCHILGPDCCIEPHDWTKNITDKIDQIIHDFVDKTL",
		"Level": 3
	},
	{
		"mAb": "133/3.16",
		"inicio": 521,
		"fin": 560,
		"GPRegion": "Z:GP2",
		"Conservation": "97.50%",
		"EpType": "Conformational",
		"EpSeq": "QDEGAAIGLAWIPYFGPAAEGIYTEGLMHNQDGLICGLRQ",
		"Level": 7
	},
	{
		"mAb": "226/8.1",
		"inicio": 1,
		"fin": 232,
		"GPRegion": "Z:GP1,sGP",
		"Conservation": "97.40%",
		"EpType": "Conformational",
		"EpSeq": "MGVTGILQLPRDRFKRTSFFLWVIILFQRTFSIPLGVIHNSTLQVSEVDKLVCRDKLSSTNQLRSVGLNLEGNGVATDVPSATKRWGFRSGVPPKVVNYEAGEWAENCYNLEIKKPDGSECLPAAPDGIRGFPRCRYVHKVSGTGPCAGDFAFHKEGAFFLYDRLASTVIYRGTTFAEGVVAFLILPQAKKDFFSSHPLREPVNATEDPSSGYYSTTIRYQATGFGTNETEY",
		"Level": 2
	}, /* 20 */
	{
		"mAb": "JP3K11",
		"inicio": 302,
		"fin": 479,
		"GPRegion": "Z:GP1 GP2, sGP",
		"Conservation": "90%",
		"EpType": "Conformational",
		"EpSeq": "RSEELSFTAVSNRAKNISGQSPARTSSDPGTNTTTEDHKIMASENSSAMVQVHSQGREAAVSHLTTLATISTSPQPPTTKPGPDNSTHNTPVYKLDISEATQVEQHHRRTDNDSTASDTPPATTAAGPPKAENTNTSKGTDLLDPATTTSPQNHSETAGNNNTHHQDTGEESASSGKLVNAQPKCNPNHNQDGLIC",
		"Level": 2
	},
	{
		"mAb": "JP3K11",
		"inicio": 505,
		"fin": 514,
		"GPRegion": "Z:GP1 GP2, sGP",
		"Conservation": "90%",
		"EpType": "Conformational",
		"EpSeq": "RSEELSFTAVSNRAKNISGQSPARTSSDPGTNTTTEDHKIMASENSSAMVQVHSQGREAAVSHLTTLATISTSPQPPTTKPGPDNSTHNTPVYKLDISEATQVEQHHRRTDNDSTASDTPPATTAAGPPKAENTNTSKGTDLLDPATTTSPQNHSETAGNNNTHHQDTGEESASSGKLVNAQPKCNPNHNQDGLIC",
		"Level": 2
	},
	{
		"mAb": "JP3K11",
		"inicio": 549,
		"fin": 556,
		"GPRegion": "Z:GP1 GP2, sGP",
		"Conservation": "90%",
		"EpType": "Conformational",
		"EpSeq": "RSEELSFTAVSNRAKNISGQSPARTSSDPGTNTTTEDHKIMASENSSAMVQVHSQGREAAVSHLTTLATISTSPQPPTTKPGPDNSTHNTPVYKLDISEATQVEQHHRRTDNDSTASDTPPATTAAGPPKAENTNTSKGTDLLDPATTTSPQNHSETAGNNNTHHQDTGEESASSGKLVNAQPKCNPNHNQDGLIC",
		"Level": 2
	},
	{
		"mAb": "S9",
		"inicio": 293,
		"fin": 307,
		"GPRegion": "Z:GP1,sGP",
		"Conservation": "100%",
		"EpType": "Linear",
		"EpSeq": "TKKNLTRKIRSEELSC ",
		"Level": 1
	}];

const ANTICUERPOSCOUNT = arrAnticuerpos.length;

$(document).ready(function () {
	var tabla = $("table.tablaProteinas");
	tabla.html("<tr><th>mAb</th><th>Range</th><th>Specific strain: GP region</th><th>Percentage of conservation</th><th>Epitope type</th><th>Epitopes</th></tr>");
	var tablaEpitopes = $("table.tablaEpitopes");
	tablaEpitopes.html("<tr><th>mAb</th><th>Epitopes</th></tr>");

	for (var ii = 0; ii < ANTICUERPOSCOUNT; ii++) {
		var builtHtml = "<tr><td>" + arrAnticuerpos[ii].mAb + "</td><td>" + arrAnticuerpos[ii].inicio + " - " + arrAnticuerpos[ii].fin + "</td><td>" + arrAnticuerpos[ii].GPRegion + "</td><td>" + arrAnticuerpos[ii].Conservation + "</td><td>" + arrAnticuerpos[ii].EpType + "</td><td style='font-size:5px;'>" + arrAnticuerpos[ii].EpSeq + "</td></tr>";
		tabla.html(tabla.html() + builtHtml);

		builtHtml = "<tr><td>" + arrAnticuerpos[ii].mAb + "</td><td>" + arrAnticuerpos[ii].EpSeq + "</td></tr>";
		tablaEpitopes.html(tablaEpitopes.html() + builtHtml);
	}
});


var ANCHO = 45;
var ANCHOTOTAL = 55;
var ESPACIADO = 5;
var RADIO = 3;
var TEXT = "12px Arial";
var TEXTCOLOR = "#000000";


function init() {
	// Crear el stage para dibujar sobre él
	var stage = new createjs.Stage("drawingCanvas");

	// Crear variables para las funciones que dibujan rectángulos de selección
	var rec = new createjs.Shape();
	var rec2 = new createjs.Shape();
	var posIni;
	var posFin;

	// Crear arreglos de containers
	var containers = new Array();
	var shapes = new Array();
	var tags = new Array();

	// Crear GP superior
	var MAINGP = new createjs.Container();
	var GPSHAPE = new createjs.Shape();
	GPSHAPE.graphics.beginFill("#cab2d6").drawRoundRect(0, ESPACIADO, 680, ANCHO, RADIO);
	var GPLABEL = new createjs.Text("GP", TEXT, TEXTCOLOR);
	GPLABEL.textAlign = "center";
	GPLABEL.y = ANCHOTOTAL / 2 - 7;
	GPLABEL.x = 340;

	MAINGP.addChild(GPSHAPE, GPLABEL);
	stage.addChild(MAINGP);
	// Termina creación de GP superior 

	for (var z = 0; z < ANTICUERPOSCOUNT; z++) {
		var j = arrAnticuerpos[z];
		tags.push(new createjs.Text(j.mAb, TEXT, TEXTCOLOR));
		shapes.push(new createjs.Shape());
		containers.push(new createjs.Container());

		shapes[z].graphics.beginFill(getColor(z)).drawRoundRect(j.inicio, ANCHOTOTAL * j.Level + ESPACIADO, j.fin - j.inicio, ANCHO, RADIO);

		tags[z].textAlign = "center";

		tags[z].y = ANCHOTOTAL * j.Level + ANCHOTOTAL / 2 - 6;
		tags[z].x = (j.fin + j.inicio) / 2;
		containers[z].addChild(shapes[z], tags[z]);

	}

	for (var j = 0; j < ANTICUERPOSCOUNT; j++) {
		var z = containers[j];
		stage.addChild(z);
	}
	changeDescription(0);

	// Agregar listener de eventos
	stage.on("stagemousedown", mouseDown);
	stage.on("stagemouseup", mouseUp);

	stage.addChild(rec);
	stage.addChild(rec2);


	function mouseDown(event) {
		rec.graphics.clear();
		rec2.graphics.clear();
		posIni = event.stageX;
		rec.graphics.beginFill("rgba(0, 0, 0, .25").drawRect(0, 0, posIni, 500);

		stage.addChild(rec);
		stage.update();
	};

	// Esto sucede al momento de que el click es liberado
	function mouseUp(event) {
		rec2.graphics.clear();
		posFin = event.stageX;
		if (posFin > posIni) {
			rec2.graphics.beginFill("rgba(0, 0, 0, .25").drawRect(posFin, 0, 700 - posFin, 500);
			var x = filter(posIni, posFin);
			repopulateTable(x);
		} else {
			rec.graphics.clear();
		}
		stage.addChild(rec2);
		stage.update();
	};

	containers[0].on("click", function (evt) {
		changeDescription(0);
		stage.update();
	});
	containers[1].on("click", function (evt) {
		changeDescription(1);
		stage.update();
	});
	containers[2].on("click", function (evt) {
		changeDescription(2);
		stage.update();
	});
	containers[3].on("click", function (evt) {
		changeDescription(3);
		stage.update();
	});
	containers[4].on("click", function (evt) {
		changeDescription(4);
		stage.update();
	});
	containers[5].on("click", function (evt) {
		changeDescription(5);
		stage.update();
	});
	containers[6].on("click", function (evt) {
		changeDescription(6);
		stage.update();
	});
	containers[7].on("click", function (evt) {
		changeDescription(7);
		stage.update();
	});
	containers[8].on("click", function (evt) {
		changeDescription(8);
		stage.update();
	});
	containers[9].on("click", function (evt) {
		changeDescription(9);
		stage.update();
	});
	containers[10].on("click", function (evt) {
		changeDescription(10);
		stage.update();
	});
	containers[11].on("click", function (evt) {
		changeDescription(11);
		stage.update();
	});
	containers[12].on("click", function (evt) {
		changeDescription(12);
		stage.update();
	});
	containers[13].on("click", function (evt) {
		changeDescription(13);
		stage.update();
	});
	containers[14].on("click", function (evt) {
		changeDescription(14);
		stage.update();
	});
	containers[15].on("click", function (evt) {
		changeDescription(15);
		stage.update();
	});
	containers[16].on("click", function (evt) {
		changeDescription(16);
		stage.update();
	});
	containers[17].on("click", function (evt) {
		changeDescription(17);
		stage.update();
	});
	containers[18].on("click", function (evt) {
		changeDescription(18);
		stage.update();
	});
	containers[19].on("click", function (evt) {
		changeDescription(19);
		stage.update();
	});
	containers[20].on("click", function (evt) {
		changeDescription(20);
		stage.update();
	});
	containers[21].on("click", function (evt) {
		changeDescription(21);
		stage.update();
	});
	containers[22].on("click", function (evt) {
		changeDescription(22);
		stage.update();
	});
	containers[23].on("click", function (evt) {
		changeDescription(23);
		stage.update();
	});
	containers[24].on("click", function (evt) {
		changeDescription(24);
		stage.update();
	});


	stage.update();

}


function filter(pos1, pos2) {
	var arr = new Array();
	for (var i = 0; i < ANTICUERPOSCOUNT; i++) {
		if (arrAnticuerpos[i].fin > pos1 && arrAnticuerpos[i].inicio < pos2) {
			arr.push(arrAnticuerpos[i]);
		}
	}
	return arr;
}

function repopulateTable(arr) {
	var tabla = $("table.tablaProteinas");
	var tablaEpitopes = $("table.tablaEpitopes");
	l = arr.length;
	tabla.html("<tr><th>mAb</th><th>Range</th><th>Specific strain: GP region</th><th>Percentage of conservation</th><th>Epitope type</th><th>Epitopes</th></tr>");
	tablaEpitopes.html("<tr><th>mAb</th><th>Epitopes</th></tr>");
	for (var ii = 0; ii < l; ii++) {
		var builtHtml = "<tr><td>" + arr[ii].mAb + "</td><td>" + arr[ii].inicio + " - " + arr[ii].fin + "</td><td>" + arr[ii].GPRegion + "</td><td>" + arr[ii].Conservation + "</td><td>" + arr[ii].EpType + "</td><td style='font-size:5px;'>" + arr[ii].EpSeq + "</td></tr>";
		tabla.html(tabla.html() + builtHtml);
		builtHtml = "<tr><td>" + arr[ii].mAb + "</td><td>" + arr[ii].EpSeq + "</td></tr>";
		tablaEpitopes.html(tablaEpitopes.html() + builtHtml);
	}
}


function changeDescription(num) {
	var hdr = $("#prothead");
	hdr.html("mAb: " + arrAnticuerpos[num].mAb);
	var section = $("#protpar");
	section.html("<p><hr />Range: " + arrAnticuerpos[num].inicio + " - " + arrAnticuerpos[num].fin + "<hr />GP Region: " + arrAnticuerpos[num].GPRegion + "<hr />Conservation: " + arrAnticuerpos[num].Conservation + "<hr />EpType: " + arrAnticuerpos[num].EpType + "</p>");
}


function getColor(num) {
	switch (num) {
	case 0:
	case 11:
		return "#a6cee3";
		break;
	case 1:
	case 12:
		return "#1f78b4";
		break;
	case 2:
	case 13:
		return "#b2df8a";
		break;
	case 3:
	case 14:
		return "#33a02c";
		break;
	case 4:
	case 5:
		return "#fb9a99";
		break;
	case 15:
	case 16:
		return "#e31a1c";
		break;
	case 6:
	case 19:
		return "#fdbf6f";
		break;
	case 10:
	case 8:
	case 9:
		return "#cab2d6";
		break;
	case 18:
	case 17:
		return "#6a3d9a";
		break;
	case 7:
	case 20:
		return "#ffff99";
		break;
	case 23:
	case 21:
	case 22:
		return "#b15928";
		break;
	default:
		return "#ff7f00";
		break;
	}
}